---
title: How did we make Flash Viewer at ActiveReports
date: '2019-08-11'
spoiler: Open sourcing PageFX compiler
---

__TL;DR__ GrapeCity opens compiler used to build ActiveReports Flash Viewer

It was not easy path. First we implemented a cross compiler from [.NET](https://en.wikipedia.org/wiki/Common_Intermediate_Language) to [Flash Player](https://www.adobe.com/content/dam/acom/en/devnet/pdf/avm2overview.pdf) byte code.

And this post is about this cross compiling tool.
It was called [PageFX](https://github.com/GrapeCity/pagefx) later also called PFX.

## History

I started this project in June of 2007 by invitation from [Scott Willeke](https://scott.willeke.com/). Initial idea was to create a framework for building rich internet applications using Adobe Flash Player as alternative technology for [Microsoft Silverlight](https://www.microsoft.com/silverlight/).

I don't know all reasons why guys from [Data Dynamics](https://en.wikipedia.org/wiki/Data_Dynamics) decided to build such crazy cross compiler. I can guess only few:

First Ferhat Buyukkokten (VP Development) liked hacking and coding crazy projects. He made initial proof of concept of PFX compiler.

Secondly flash was popular on that time and there were millions of flash resources in the internet (games, ads, etc). Silverlight was passing first baby-born steps. So flash was a promissing technology.

After three monthes trying to implement an real-world app on top of PageFX I convinced Scott to rewrite the compiler from scratch having only the following as basis:
- [.NET CLI ECMA-335 spec](https://www.ecma-international.org/publications/files/ECMA-ST/ECMA-335.pdf) - this doc describes format of .NET executable files
- [AVM overview doc](https://www.adobe.com/content/dam/acom/en/devnet/pdf/avm2overview.pdf) - this doc describes format of byte code parsed and executed by ActionScript Virtual Machine
- [AVM source code](https://github.com/adobe/avmplus) - initial version was hosted at [Mozilla](https://hg.mozilla.org/tamarin-central)

I made few major iterations to make the compiler.
First iteration was not successful though a lot of test cases worked. I've tried to build .NET decompiler first and then translate it to AVM byte code.
I don't remember why I've decided to deny approach with decompiler, but idea with binary translation won and I've quickly implemented first prototype.

Then it took about 6 months to get working a lot of [Mono](https://www.mono-project.com/) tests for byte code generated by C# 2.0 (CLR 1.0 byte code) without generics.

First good application of PFX compiler was built by [Oleg Zaimkin](https://twitter.com/olegzeee). It was March 2008. And initial prototype was built in one or two weeks.

In July-August 2008 [Yuri Kashnikov](https://twitter.com/kayuri) joined me to help me with the project. Together we implemented a lot of things:
- Almost full support of CLR 2.0 byte code format including generics
- Interop with libraries built by ActionScript compiler (ASC)
- Debugger for Visual Studio 6.0

In Jan 2009 the project was closed. Active development was stopped. Flash Viewer for Active Reports was born and released.
I've joined [Data Dynamics Reports](https://www.componentsource.com/product/data-dynamics-reports) dev team to build Flash Viewer for our new reporting system.

## Going open source

I've just wrote a few emails recently with idea to publish code of the [PageFX at github](https://github.com/GrapeCity/pagefx). And there were no conerns with that from HQ side.

BTW in 2013 I have already discussed opening source of PageFX and on that moment company was not ready by some reasons.

I think this project might be interesting for education purposes for Microsoft Research students or any other universities.

BTW in 2009 I've made an experimental branch with a lot of interesting changes but they probably are not stable since not used in production:

- I've made PFX compiler to be cross-platform/runnable on mono VM and compatible with mono c# compiler
- Reuse of Mono MDB reader, i.e. managed PDB (debug symbols) reader
- Multi-targeting on Flash Player 9.0 and higher, i.e. Flash APIs are declared in separate assemblies auto-generated as part of build process
- Multi-targeting on Flex SDK 3.3 and higher. Interop assemblies for Flex SDK are also auto-generated
- Faster lazy parsing of assemblies with less memory consumption

Also master branch includes interesting experiments:
- JavaScript code generation (a lot of tests were passing)
- CIL interpreter written in pure C# on top of PFX infrastructure
- Port of [Starling game engine](https://gamua.com/starling/)

If someone interested to get more details about the project please [email me](mailto:stodyshev@gmail.com).

P.S. All dates might be a little bit wrong. Sorry for that)
