{"componentChunkName":"component---src-templates-blog-post-js","path":"/flash-viewer-story/","webpackCompilationHash":"f4f95a4f9e2ce9f5e562","result":{"data":{"site":{"siteMetadata":{"title":"tsvbits","author":"Sergey Todyshev"}},"markdownRemark":{"id":"9ad35c94-2b19-59f9-beab-13afc2742458","html":"<p><strong>TL;DR</strong> GrapeCity opens compiler used to build ActiveReports Flash Viewer</p>\n<p>It was not easy path. First we implemented a cross compiler from <a href=\"https://en.wikipedia.org/wiki/Common_Intermediate_Language\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">.NET</a> to <a href=\"https://www.adobe.com/content/dam/acom/en/devnet/pdf/avm2overview.pdf\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Flash Player</a> byte code.</p>\n<p>And this post is about this cross compiling tool.\nIt was called <a href=\"https://github.com/GrapeCity/pagefx\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">PageFX</a> later also called PFX.</p>\n<h2 id=\"history\"><a href=\"#history\" aria-label=\"history permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>History</h2>\n<p>I started this project in June of 2007 by invitation from <a href=\"https://scott.willeke.com/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Scott Willeke</a>. Initial idea was to create a framework for building rich internet applications using Adobe Flash Player as alternative technology for <a href=\"https://www.microsoft.com/silverlight/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Microsoft Silverlight</a>.</p>\n<p>I don’t know all reasons why guys from <a href=\"https://en.wikipedia.org/wiki/Data_Dynamics\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Data Dynamics</a> decided to build such crazy cross compiler. I can guess only few:</p>\n<p>First Ferhat Buyukkokten (VP Development) liked hacking and coding crazy projects. He made initial proof of concept of PFX compiler.</p>\n<p>Secondly flash was popular on that time and there were millions of flash resources on the internet (games, ads, etc). Silverlight was passing first baby-born steps. So flash was a promissing technology.</p>\n<p>After three monthes trying to implement an real-world app on top of PageFX I convinced Scott to rewrite the compiler from scratch having only the following as basis:</p>\n<ul>\n<li><a href=\"https://www.ecma-international.org/publications/files/ECMA-ST/ECMA-335.pdf\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">.NET CLI ECMA-335 spec</a> - this doc describes format of .NET executable files</li>\n<li><a href=\"https://www.adobe.com/content/dam/acom/en/devnet/pdf/avm2overview.pdf\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">AVM overview doc</a> - this doc describes format of byte code parsed and executed by ActionScript Virtual Machine</li>\n<li><a href=\"https://github.com/adobe/avmplus\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">AVM source code</a> - initial version was hosted at <a href=\"https://hg.mozilla.org/tamarin-central\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Mozilla</a></li>\n</ul>\n<p>I made few major iterations to make the compiler.\nFirst iteration was not successful though a lot of test cases worked. I’ve tried to build .NET decompiler first and then translate it to AVM byte code.\nI don’t remember why I’ve decided to deny approach with decompiler, but idea with binary translation won and I’ve quickly implemented first prototype.</p>\n<p>Then it took about 6 months to get working a lot of <a href=\"https://www.mono-project.com/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Mono</a> tests for byte code generated by C# 2.0 (CLR 1.0 byte code) without generics.</p>\n<p>First good application of PFX compiler was built by <a href=\"https://twitter.com/olegzeee\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Oleg Zaimkin</a>. Initial prototype was hacked by Oleg in July 2008 in few weeks during his vacation.</p>\n<p>In July-August 2008 <a href=\"https://twitter.com/kayuri\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Yuri Kashnikov</a> joined me to help me with the project. Together we implemented a lot of things:</p>\n<ul>\n<li>Almost full support of CLR 2.0 byte code format including generics</li>\n<li>Interop with libraries built by ActionScript compiler (ASC)</li>\n<li>Debugger for Visual Studio 2008</li>\n</ul>\n<p>In Jan 2009 the project was closed. Actually active development was stopped but it was still used to compile Flash Viewer for Active Reports. And it was released that year.</p>\n<p>I’ve joined <a href=\"https://www.componentsource.com/product/data-dynamics-reports\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Data Dynamics Reports</a> dev team to build Flash Viewer for our new reporting system.</p>\n<p>Funny fact. The compiler was used almost ten years without any fixes to build Flash Viewer until drop of its support. I know it had bugs, but it was enough for Flash Viewer.</p>\n<h2 id=\"going-open-source\"><a href=\"#going-open-source\" aria-label=\"going open source permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Going open source</h2>\n<p>I’ve just wrote a few emails recently with idea to publish code of the <a href=\"https://github.com/GrapeCity/pagefx\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">PageFX at github</a>. And there were no conerns with that from HQ side.</p>\n<p>BTW in 2013 I have already discussed opening source of PageFX and on that moment company was not ready by some reasons.</p>\n<p>I think this project might be interesting for education purposes for Microsoft Research students or any other universities.</p>\n<p>BTW in 2009 I’ve made an experimental branch with a lot of interesting changes but they probably are not stable since not used in production:</p>\n<ul>\n<li>I’ve made PFX compiler to be cross-platform/runnable on mono VM and compatible with mono c# compiler</li>\n<li>Reuse of Mono MDB reader, i.e. managed PDB (debug symbols) reader</li>\n<li>Multi-targeting on Flash Player 9.0 and higher, i.e. Flash APIs are declared in separate assemblies auto-generated as part of build process</li>\n<li>Multi-targeting on Flex SDK 3.3 and higher. Interop assemblies for Flex SDK are also auto-generated</li>\n<li>Faster lazy parsing of assemblies with less memory consumption</li>\n</ul>\n<p>Also master branch includes interesting experiments:</p>\n<ul>\n<li>JavaScript code generation (a lot of tests were passing)</li>\n<li>CIL interpreter written in pure C# on top of PFX infrastructure</li>\n<li>Port of <a href=\"https://gamua.com/starling/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Starling game engine</a></li>\n</ul>\n<p>You might find interesting <a href=\"https://github.com/sergeyt/cil.js\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">this old project</a>.\nIt has declarative <a href=\"https://github.com/sergeyt/cil.js/blob/master/src/runtime/meta.js\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">CIL reader</a> written in JavaScript.\nThis could be a starting point for full CIL interpreter in JavaScript.</p>\n<p>If someone interested to get more details about the project please <a href=\"mailto:stodyshev@gmail.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">email me</a>.\nI can write a series of blog posts perhaps someone may find it interesting.</p>\n<p>P.S. All dates might be a little bit wrong. Sorry for that)</p>","timeToRead":4,"frontmatter":{"title":"How did we make Flash Viewer at ActiveReports","date":"August 11, 2019","spoiler":"Open sourcing PageFX compiler"},"fields":{"slug":"/flash-viewer-story/","langKey":"en"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/flash-viewer-story/","previous":{"fields":{"slug":"/started-my-blog/","langKey":"en","directoryName":"started-my-blog","maybeAbsoluteLinks":[]},"frontmatter":{"title":"Started my blog"}},"next":null,"translations":["zh-hans"],"translatedLinks":[]}}}